<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>3D deneme oyunu</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Segoe UI', sans-serif; }
        
        /* MENÜ KATMANLARI */
        #ui-overlay {
            position: absolute; width: 100%; height: 100%; z-index: 10;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.7); color: white;
        }

        .menu-box { background: rgba(20,20,20,0.9); padding: 40px; border-radius: 20px; border: 2px solid #ffcc00; text-align: center; min-width: 350px; }
        
        button { 
            padding: 15px 30px; font-size: 18px; font-weight: bold; cursor: pointer; 
            border: none; border-radius: 10px; transition: 0.3s; margin: 10px; width: 80%;
        }
        .primary-btn { background: #ffcc00; color: #111; }
        .secondary-btn { background: rgba(255,255,255,0.1); color: white; border: 1px solid #555; }
        button:hover { transform: scale(1.05); filter: brightness(1.2); }

        #crosshair { 
            position: absolute; top: 50%; left: 50%; width: 15px; height: 15px; 
            border: 2px solid rgba(255,255,255,0.8); border-radius: 50%; 
            transform: translate(-50%, -50%); display: none; pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="ui-overlay">
        <div class="menu-box" id="main-container">
            <h1 id="title-text">3D DENEME OYUNU</h1>
            
            <div id="start-menu">
                <p id="char-label">Karakter Seç</p>
                <div style="display:flex; justify-content:center;">
                    <button class="secondary-btn" style="width:140px;" onclick="selectChar('blue')">Mavi Karakter</button>
                    <button class="secondary-btn" style="width:140px;" onclick="selectChar('red')">Kırmızı Karakter</button>
                </div>
                <button class="primary-btn" id="main-start-btn" onclick="startGame()">MAÇA BAŞLA</button>
                <button class="secondary-btn" onclick="showSubMenu('settings')">Ayarlar</button>
            </div>

            <div id="pause-menu" style="display:none;">
                <button class="primary-btn" onclick="startGame()">OYUNA DEVAM ET</button>
                <button class="secondary-btn" onclick="location.reload()">ANA MENÜYE DÖN</button>
            </div>

            <div id="settings-menu" style="display:none;">
                <h3>Dil Seçeneği</h3>
                <button class="secondary-btn" onclick="setLang('tr')">Türkçe</button>
                <button class="secondary-btn" onclick="setLang('en')">English</button>
                <button class="primary-btn" style="background:#ff4444" onclick="showSubMenu('main')">Geri</button>
            </div>
        </div>
    </div>

    <div id="crosshair"></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let isPaused = true;
        let lang = 'tr';
        const texts = {
            tr: { title: "3D DENEME OYUNU", start: "MAÇA BAŞLA", resume: "OYUNA DEVAM ET", char: "Karakter Seç", settings: "Ayarlar", back: "Geri" },
            en: { title: "3D TRIAL GAME", start: "START MATCH", resume: "CONTINUE", char: "Select Character", settings: "Settings", back: "Back" }
        };

        // --- SAHNE KURULUMU ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        const light = new THREE.DirectionalLight(0xffffff, 1.2);
        light.position.set(10, 20, 10);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x606060));

        // ZEMİN
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({ color: 0x2d5a27 }));
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // --- DAHA GERÇEKÇİ KARAKTER MODELLEME ---
        function createAdvancedHuman(color) {
            const group = new THREE.Group();
            const mat = new THREE.MeshStandardMaterial({color: color});
            const skinMat = new THREE.MeshStandardMaterial({color: 0xffdbac});

            // Gövde (V şeklinde)
            const torso = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.9, 0.3), mat);
            torso.position.y = 1.35; group.add(torso);

            // Kafa
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.35, 0.35, 0.35), skinMat);
            head.position.y = 2.05; group.add(head);

            // Kollar (Eklem detaylı görünümlü)
            const armGeo = new THREE.BoxGeometry(0.2, 0.8, 0.2);
            const lArm = new THREE.Mesh(armGeo, mat); lArm.position.set(-0.45, 1.35, 0); group.add(lArm);
            const rArm = new THREE.Mesh(armGeo, mat); rArm.position.set(0.45, 1.35, 0); group.add(rArm);

            // Bacaklar
            const legGeo = new THREE.BoxGeometry(0.25, 0.9, 0.25);
            const lLeg = new THREE.Mesh(legGeo, new THREE.MeshStandardMaterial({color: 0x222222}));
            lLeg.position.set(-0.18, 0.45, 0); group.add(lLeg);
            const rLeg = new THREE.Mesh(legGeo, new THREE.MeshStandardMaterial({color: 0x111111}));
            rLeg.position.set(0.18, 0.45, 0); group.add(rLeg);

            group.userData = { lLeg, rLeg, lArm, rArm };
            return group;
        }

        let player = createAdvancedHuman(0x0066ff);
        scene.add(player);

        // --- GLOBAL FONKSİYONLAR ---
        window.selectChar = (color) => {
            scene.remove(player);
            player = createAdvancedHuman(color === 'blue' ? 0x0066ff : 0xff3300);
            scene.add(player);
        };

        window.showSubMenu = (menu) => {
            document.getElementById('start-menu').style.display = menu === 'main' ? 'block' : 'none';
            document.getElementById('settings-menu').style.display = menu === 'settings' ? 'block' : 'none';
            document.getElementById('pause-menu').style.display = 'none';
        };

        window.setLang = (l) => {
            lang = l;
            document.getElementById('title-text').innerText = texts[l].title;
            document.getElementById('main-start-btn').innerText = texts[l].start;
            document.getElementById('char-label').innerText = texts[l].char;
            showSubMenu('main');
        };

        window.startGame = () => {
            isPaused = false;
            document.getElementById('ui-overlay').style.display = 'none';
            document.getElementById('crosshair').style.display = 'block';
        };

        // ESC İLE MENÜYÜ AÇMA
        window.addEventListener('keydown', (e) => {
            if (e.code === 'Escape') {
                isPaused = true;
                document.getElementById('ui-overlay').style.display = 'flex';
                document.getElementById('start-menu').style.display = 'none';
                document.getElementById('pause-menu').style.display = 'block';
                document.getElementById('settings-menu').style.display = 'none';
                document.getElementById('crosshair').style.display = 'none';
            }
            keys[e.code] = true;
        });

        const keys = {};
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        let yaw = 0, pitch = 0, walkTime = 0;
        document.addEventListener('mousemove', (e) => {
            if(!isPaused && e.buttons === 1) {
                yaw -= e.movementX * 0.005;
                pitch = Math.max(-0.8, Math.min(0.2, pitch - e.movementY * 0.005));
            }
        });

        function update() {
            if (isPaused) {
                player.rotation.y += 0.01;
                camera.position.set(0, 2.5, 5);
                camera.lookAt(0, 1.5, 0);
                return;
            }

            player.rotation.y = yaw;
            let moving = false;
            if (keys['KeyW']) { player.translateZ(-0.1); moving = true; }
            if (keys['KeyS']) { player.translateZ(0.1); moving = true; }

            // Animasyon (Kol ve bacak sallanması)
            if(moving) {
                walkTime += 0.15;
                player.userData.lLeg.rotation.x = Math.sin(walkTime) * 0.6;
                player.userData.rLeg.rotation.x = -Math.sin(walkTime) * 0.6;
                player.userData.lArm.rotation.x = -Math.sin(walkTime) * 0.4;
                player.userData.rArm.rotation.x = Math.sin(walkTime) * 0.4;
            } else {
                player.userData.lLeg.rotation.x = 0;
                player.userData.rLeg.rotation.x = 0;
            }

            const camDist = 6;
            camera.position.set(
                player.position.x + Math.sin(yaw) * Math.cos(pitch) * camDist,
                player.position.y + 3.5 + Math.sin(pitch) * camDist,
                player.position.z + Math.cos(yaw) * Math.cos(pitch) * camDist
            );
            camera.lookAt(player.position.x, player.position.y + 1.5, player.position.z);
        }

        function animate() { requestAnimationFrame(animate); update(); renderer.render(scene, camera); }
        animate();
    </script>
</body>
</html>
