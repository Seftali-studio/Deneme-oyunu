<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>3D deneme oyunu</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #111; font-family: sans-serif; }
        #ui-layer {
            position: absolute; width: 100%; height: 100%; z-index: 100;
            display: flex; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.85);
        }
        .menu-box { 
            background: #222; padding: 40px; border-radius: 20px; 
            border: 3px solid #ffcc00; text-align: center; color: white; min-width: 350px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        button { 
            padding: 15px; margin: 8px; width: 100%; font-size: 16px; font-weight: bold; 
            cursor: pointer; border-radius: 8px; border: none; transition: 0.2s;
        }
        .btn-main { background: #ffcc00; color: #000; }
        .btn-side { background: #444; color: white; }
        button:hover { transform: scale(1.03); filter: brightness(1.2); }
        #crosshair { 
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; 
            border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%);
            display: none; pointer-events: none; z-index: 50;
        }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="menu-box">
            <h1 id="txt-title">3D DENEME OYUNU</h1>
            
            <div id="area-main">
                <p id="txt-select">Karakter Seç</p>
                <div style="display:flex; gap:5px;">
                    <button class="btn-side" onclick="selectChar('blue')">Mavi Karakter</button>
                    <button class="btn-side" onclick="selectChar('red')">Kırmızı Karakter</button>
                </div>
                <button class="btn-main" id="txt-start" onclick="startGame()">MAÇA BAŞLA</button>
                <div style="margin-top:10px; border-top: 1px solid #444; padding-top:10px;">
                    <button class="btn-side" style="width:45%" onclick="setLang('tr')">Türkçe</button>
                    <button class="btn-side" style="width:45%" onclick="setLang('en')">English</button>
                </div>
            </div>

            <div id="area-pause" style="display:none;">
                <button class="btn-main" id="txt-resume" onclick="startGame()">DEVAM ET</button>
                <button class="btn-side" onclick="setLang('tr')">Türkçe</button>
                <button class="btn-side" onclick="setLang('en')">English</button>
                <button class="btn-side" style="background:#800" onclick="location.reload()">MENÜYE DÖN</button>
            </div>
        </div>
    </div>

    <div id="crosshair"></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let gameStarted = false;
        let isPaused = true;
        let lang = 'tr';
        const texts = {
            tr: { title: "3D DENEME OYUNU", start: "MAÇA BAŞLA", select: "Karakter Seç", resume: "DEVAM ET" },
            en: { title: "3D TRIAL GAME", start: "START MATCH", select: "Select Hero", resume: "CONTINUE" }
        };

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // IŞIKLAR
        const sun = new THREE.DirectionalLight(0xffffff, 1.5);
        sun.position.set(5, 15, 10);
        scene.add(sun);
        scene.add(new THREE.AmbientLight(0x707070));

        // ZEMİN (Doku garantili)
        const floorGeo = new THREE.PlaneGeometry(100, 100);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0x2d5a27 }); // Düz yeşil (önlem)
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // DOKU EKLEME (Opsiyonel, hata verirse sistemi bozmaz)
        try {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#1a3c15'; ctx.fillRect(0,0,128,128);
            for(let i=0; i<500; i++){
                ctx.fillStyle = '#2d5a27'; ctx.fillRect(Math.random()*128, Math.random()*128, 2, 2);
            }
            const tex = new THREE.CanvasTexture(canvas);
            tex.wrapS = tex.wrapT = THREE.RepeatWrapping;
            tex.repeat.set(20,20);
            floorMat.map = tex;
        } catch(e) { console.log("Doku yüklenemedi, düz renk devam ediyor."); }

        // KARAKTER
        function createModel(colorCode) {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.9, 0.3), new THREE.MeshStandardMaterial({color: colorCode}));
            body.position.y = 1.35; group.add(body);
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.35, 0.35, 0.35), new THREE.MeshStandardMaterial({color: 0xffdbac}));
            head.position.y = 2.05; group.add(head);
            const leg = new THREE.BoxGeometry(0.25, 0.8, 0.25);
            const lLeg = new THREE.Mesh(leg, new THREE.MeshStandardMaterial({color: 0x222222}));
            lLeg.position.set(-0.15, 0.4, 0); group.add(lLeg);
            const rLeg = new THREE.Mesh(leg, new THREE.MeshStandardMaterial({color: 0x222222}));
            rLeg.position.set(0.15, 0.4, 0); group.add(rLeg);
            group.userData = { lLeg, rLeg };
            return group;
        }

        let player = createModel(0x0066ff);
        scene.add(player);

        // --- BUTON FONKSİYONLARI ---
        window.setLang = (l) => {
            lang = l;
            document.getElementById('txt-title').innerText = texts[l].title;
            document.getElementById('txt-start').innerText = texts[l].start;
            document.getElementById('txt-select').innerText = texts[l].select;
            document.getElementById('txt-resume').innerText = texts[l].resume;
        };

        window.selectChar = (c) => {
            player.children[0].material.color.set(c === 'blue' ? 0x0066ff : 0xff3300);
        };

        window.startGame = () => {
            isPaused = false;
            gameStarted = true;
            document.getElementById('ui-layer').style.display = 'none';
            document.getElementById('crosshair').style.display = 'block';
        };

        const keys = {};
        window.addEventListener('keydown', (e) => {
            if(e.code === 'Escape' && gameStarted) {
                isPaused = true;
                document.getElementById('ui-layer').style.display = 'flex';
                document.getElementById('area-main').style.display = 'none';
                document.getElementById('area-pause').style.display = 'block';
                document.getElementById('crosshair').style.display = 'none';
            }
            keys[e.code] = true;
        });
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        let yaw = 0, pitch = 0, vY = 0, walk = 0;
        document.addEventListener('mousemove', (e) => {
            if(!isPaused && (e.buttons === 1 || document.pointerLockElement)) {
                yaw -= e.movementX * 0.005;
                pitch = Math.max(-0.6, Math.min(0.2, pitch - e.movementY * 0.005));
            }
        });

        function update() {
            if (isPaused) {
                player.rotation.y += 0.01;
                camera.position.set(Math.sin(Date.now()*0.001)*2, 2.5, 6);
                camera.lookAt(0, 1.5, 0);
            } else {
                player.rotation.y = yaw;
                let move = false;
                const dist = 50;
                const inside = Math.abs(player.position.x) < dist && Math.abs(player.position.z) < dist;

                if (inside && player.position.y <= 0) {
                    player.position.y = 0; vY = 0;
                    if(keys['KeyW']) { player.translateZ(-0.12); move = true; }
                    if(keys['KeyS']) { player.translateZ(0.12); move = true; }
                    if(keys['KeyA']) { player.translateX(-0.12); move = true; }
                    if(keys['KeyD']) { player.translateX(0.12); move = true; }
                } else {
                    vY -= 0.015;
                    player.position.y += vY;
                    if(player.position.y < -30) { player.position.set(0,5,0); vY = 0; }
                }

                if(move) {
                    walk += 0.15;
                    player.userData.lLeg.rotation.x = Math.sin(walk)*0.5;
                    player.userData.rLeg.rotation.x = Math.sin(walk+Math.PI)*0.5;
                } else {
                    player.userData.lLeg.rotation.x = player.userData.rLeg.rotation.x = 0;
                }

                const d = 7;
                camera.position.set(
                    player.position.x + Math.sin(yaw)*Math.cos(pitch)*d,
                    player.position.y + 3.5 + Math.sin(pitch)*d,
                    player.position.z + Math.cos(yaw)*Math.cos(pitch)*d
                );
                camera.lookAt(player.position.x, player.position.y + 1.5, player.position.z);
            }
        }

        function animate() { requestAnimationFrame(animate); update(); renderer.render(scene, camera); }
        animate();
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
